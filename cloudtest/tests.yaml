---
executions:
  - name: "tests"
    env:
      - ARTIFACTS_ARCHIVE=true
    root: ./
    timeout: 3600
    cluster-count: 1
    cluster-selector:
      - packet
    cluster-env:
      - KUBECONFIG
    on-fail: |
      date "+%Y-%m-%d %H:%M:%S"
      kubectl get ns
      kubectl get all --all-namespaces
      echo found namespace $(kubectl get ns --template "{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}" | grep ns-)
      kubectl -n $(kubectl get ns --template "{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}" | grep ns-) get pods
      kubectl -n $(kubectl get ns --template "{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}" | grep ns-) describe pods
      kubectl -n $(kubectl get ns --template "{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}" | grep ns-) exec $(kubectl -n $(kubectl get ns --template "{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}" | grep ns-) get pods -l app=nse-vfio --template '{{range .items}}{{.metadata.name}}{{"\n"}}{{end}}') -- ps
      date "+%Y-%m-%d %H:%M:%S"
